<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ì†ì•ˆì˜ ì„±ê²½ ê²€ìƒ‰</title>
    <style>
        /* --- [1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ë°ìŠ¤í¬íƒ‘ ê¸°ì¤€)] --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; /* ëª¨ë°”ì¼ ê°€ë…ì„± í°íŠ¸ */
            background-color: #f0f2f5; 
            display: flex; 
            justify-content: center; 
            padding: 40px 20px; /* ìƒí•˜ ì¢Œìš° ì—¬ë°± */
            margin: 0;
        }
        
        .container { 
            width: 100%; 
            max-width: 700px; 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
        }

        h1 { 
            text-align: center; 
            color: #2c3e50; 
            margin: 0 0 25px 0; 
            font-size: 24px;
        }
        
        /* ê²€ìƒ‰ ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ */
        .search-controls { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        
        select, input, button { 
            padding: 12px; 
            border-radius: 8px; 
            border: 1px solid #ddd; 
            font-size: 16px; 
            outline: none;
            -webkit-appearance: none; /* ì•„ì´í° ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì œê±° */
        }
        
        select { background-color: #fff; min-width: 100px; }
        input { flex: 1; } /* ë‚¨ì€ ê³µê°„ ë‹¤ ì°¨ì§€í•˜ê¸° */
        button { 
            background-color: #5c6bc0; 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-weight: bold;
            min-width: 80px;
        }
        button:active { background-color: #3f51b5; } /* ëˆŒë €ì„ ë•Œ íš¨ê³¼ */
        
        /* ê²°ê³¼ ìˆ˜ ë° ë¡œë”© */
        .count-display { margin-bottom: 15px; color: #666; font-size: 14px; text-align: right; }
        .highlight { color: #e74c3c; font-weight: bold; }
        .loading { text-align: center; color: #888; margin: 20px 0; font-size: 14px; }

        /* ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ë””ìì¸ */
        .result-item { 
            border-bottom: 1px solid #f1f1f1; 
            padding: 20px 0; 
        }
        .result-item:last-child { border-bottom: none; }
        
        .result-item h3 { 
            margin: 0 0 10px; 
            font-size: 17px; 
            color: #2c3e50; 
            background-color: #f5f7fa; 
            display: inline-block; 
            padding: 5px 10px; 
            border-radius: 6px; 
        }
        
        .verse-box { display: grid; gap: 6px; }
        .verse-text { 
            margin: 0; 
            line-height: 1.6; 
            padding-left: 10px; 
            border-left: 3px solid transparent; 
            font-size: 15px; /* ë³¸ë¬¸ í°íŠ¸ í¬ê¸° */
            word-break: keep-all; /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
        }
        .kr { color: #333; border-left-color: #e74c3c; font-weight: 500;}
        .hr { color: #2e7d32; border-left-color: #2e7d32; font-style: italic; font-size: 14px; }
        .en { color: #1976d2; border-left-color: #1976d2; font-size: 14px; }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination { display: flex; justify-content: center; gap: 4px; margin-top: 30px; flex-wrap: wrap; }
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #eee;
            background-color: white;
            color: #555;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
        }
        .page-btn.active { background-color: #5c6bc0; color: white; border-color: #5c6bc0; }


        /* --- [2. ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ (ë°˜ì‘í˜•)] --- */
        /* í™”ë©´ í­ì´ 600px ì´í•˜(ìŠ¤ë§ˆíŠ¸í°)ì¼ ë•Œë§Œ ì ìš©ë˜ëŠ” ê·œì¹™ */
        @media (max-width: 600px) {
            body {
                padding: 10px; /* ì „ì²´ ì—¬ë°± ì¤„ì„ */
                background-color: #fff; /* ëª¨ë°”ì¼ì€ í° ë°°ê²½ì´ ê¹”ë” */
            }
            .container {
                padding: 15px;
                box-shadow: none; /* ê·¸ë¦¼ì ì œê±° */
            }
            h1 {
                font-size: 20px; /* ì œëª© í¬ê¸° ì¤„ì„ */
                margin-bottom: 20px;
            }
            
            /* ê²€ìƒ‰ì°½ ì„¸ë¡œ ë°°ì¹˜ */
            .search-controls {
                flex-direction: column; /* ì„¸ë¡œë¡œ ìŒ“ê¸° */
                gap: 8px;
            }
            select, input, button {
                width: 100%; /* ê°€ë¡œ ê½‰ ì±„ìš°ê¸° */
                height: 48px; /* ì†ê°€ë½ í„°ì¹˜í•˜ê¸° ì¢‹ê²Œ ë†’ì´ í‚¤ì›€ */
                font-size: 16px; /* í°íŠ¸ í‚¤ì›€ */
            }
            
            /* ë³¸ë¬¸ ê°€ë…ì„± ì¡°ì • */
            .verse-text {
                font-size: 16px; /* ëª¨ë°”ì¼ì—ì„œ ê¸€ì”¨ê°€ ë” ì˜ ë³´ì´ê²Œ */
                padding-left: 8px;
            }
            .result-item {
                padding: 15px 0;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“– ì„±ê²½ ê²€ìƒ‰ (í¬ë¡œì•„í‹°ì•„ì–´, ê°œì—­ê°œì •, NIV)</h1>
    
    <div class="search-controls">
        <select id="searchLang">
            <option value="kr">í•œêµ­ì–´ (KR)</option>
            <option value="hr">í¬ë¡œì•„í‹°ì•„ì–´ (HR)</option>
            <option value="en">English (NIV)</option>
        </select>
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ (ì˜ˆ: ì‚¬ë‘, ì°½ì„¸ê¸° 1:1)">
        <button onclick="searchBible()">ê²€ìƒ‰</button>
    </div>

    <div id="resultCount" class="count-display"></div>
    
    <div id="status" class="loading">
        ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...<br>
        (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”)
    </div>
    
    <div id="results"></div>
    <div id="pagination" class="pagination"></div>
</div>

<script>
    let bibleData = [];
    let currentFilteredData = []; 
    let currentPage = 1;          
    const rowsPerPage = 10;       

    // ì‚¬ìš©ì ë°ì´í„° URL
    const DATA_URL = 'https://script.google.com/macros/s/AKfycbzBUhwXIy5dswQuzE3vWtPnaCZEOtcP2ryif07-HuG4Qv75YbqWtVL_DWZiN2EdEUkC/exec';

    fetch(DATA_URL)
    .then(response => response.json())
    .then(data => {
        bibleData = data;
        const statusDiv = document.getElementById('status');
        statusDiv.innerHTML = "âœ… ì¤€ë¹„ ì™„ë£Œ!";
        setTimeout(() => { statusDiv.style.display = 'none'; }, 1000);
    })
    .catch(error => {
        console.error(error);
        document.getElementById('status').innerText = "âŒ ë°ì´í„° ì—°ê²° ì‹¤íŒ¨ (ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•˜ì„¸ìš”)";
        document.getElementById('status').style.color = "red";
    });

    function searchBible() {
        const langMode = document.getElementById('searchLang').value;
        const input = document.getElementById('searchInput').value.toLowerCase().trim();
        
        if (input === "") { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
        if (bibleData.length === 0) { alert("ì•„ì§ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤."); return; }

        // ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ìˆ¨ê¸°ê¸° (ê²€ìƒ‰ ë²„íŠ¼ ëˆ„ë¥´ë©´)
        document.getElementById('searchInput').blur();

        currentFilteredData = bibleData.filter(item => {
            let contentText = "";
            if (langMode === 'kr') contentText = item.content_kr;
            else if (langMode === 'hr') contentText = item.content_hr;
            else if (langMode === 'en') contentText = item.content_en;
            
            if (!contentText) contentText = "";

            const bookName = item.book ? item.book.toLowerCase() : "";
            const verseRef = `${item.chapter}:${item.verse}`; 

            const basicMatch = contentText.toLowerCase().includes(input) || 
                               bookName.includes(input) || 
                               verseRef === input;

            let complexMatch = false;
            if (input.includes(' ')) {
                const lastSpaceIndex = input.lastIndexOf(' ');
                const searchBook = input.substring(0, lastSpaceIndex).trim();
                const searchRef = input.substring(lastSpaceIndex + 1).trim();

                if (bookName.includes(searchBook)) {
                    if (searchRef.includes(':')) {
                        if (verseRef === searchRef) complexMatch = true;
                    } else {
                        if (verseRef.startsWith(searchRef + ':')) complexMatch = true;
                    }
                }
            }
            return basicMatch || complexMatch;
        });

        currentPage = 1; 
        updateCountDisplay(); 
        displayList(); 
        setupPagination(); 
    }

    function updateCountDisplay() {
        const countDiv = document.getElementById('resultCount');
        if (currentFilteredData.length > 0) {
            countDiv.innerHTML = `ì´ <span class="highlight">${currentFilteredData.length}</span>êµ¬ì ˆ ë°œê²¬`;
        } else {
            countDiv.innerHTML = "";
        }
    }

    function displayList() {
        const resultContainer = document.getElementById('results');
        resultContainer.innerHTML = "";
        // í™”ë©´ ë§¨ ìœ„ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
        window.scrollTo({ top: 0, behavior: 'smooth' });

        if (currentFilteredData.length === 0) {
            resultContainer.innerHTML = '<div style="text-align:center; color:#888; padding:30px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const paginatedItems = currentFilteredData.slice(start, end);

        paginatedItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'result-item';
            div.innerHTML = `
                <h3>${item.book} ${item.chapter}:${item.verse}</h3>
                <div class="verse-box">
                    <p class="verse-text kr">ğŸ‡°ğŸ‡· ${item.content_kr}</p>
                    <p class="verse-text hr">ğŸ‡­ğŸ‡· ${item.content_hr}</p>
                    <p class="verse-text en">ğŸ‡ºğŸ‡¸ ${item.content_en}</p>
                </div>
            `;
            resultContainer.appendChild(div);
        });
    }

    function setupPagination() {
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = "";

        const pageCount = Math.ceil(currentFilteredData.length / rowsPerPage);
        if (pageCount <= 1) return;

        // ëª¨ë°”ì¼ì—ì„œëŠ” í˜ì´ì§€ ë²„íŠ¼ì„ 5ê°œê¹Œì§€ë§Œ ë³´ì—¬ì£¼ë„ë¡ ì œí•œ (ê°„ë‹¨í™”)
        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(pageCount, startPage + 4);
        
        // í˜ì´ì§€ ë²”ìœ„ ë³´ì •
        if (endPage - startPage < 4) {
            startPage = Math.max(1, endPage - 4);
        }

        for (let i = startPage; i <= endPage; i++) {
            const btn = document.createElement('button');
            btn.innerText = i;
            btn.className = 'page-btn';
            
            if (i === currentPage) btn.classList.add('active');

            btn.addEventListener('click', function() {
                currentPage = i;
                displayList(); 
                setupPagination(); // í˜ì´ì§€ ë²„íŠ¼ë„ ë‹¤ì‹œ ê·¸ë¦¼ (ì´ë™ íš¨ê³¼)
            });

            paginationContainer.appendChild(btn);
        }
    }

    document.getElementById('searchInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') searchBible();
    });
</script>

</body>
</html>
