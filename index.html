<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ìš©ëŸ‰ ì„±ê²½ ê²€ìƒ‰ê¸°</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; padding-top: 50px; }
        .container { width: 100%; max-width: 750px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        
        .search-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        select, input, button { padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; }
        input { flex: 1; }
        button { background-color: #5c6bc0; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #3949ab; }
        
        /* ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .count-display { margin-bottom: 15px; color: #666; font-size: 14px; text-align: right; }
        .highlight { color: #e74c3c; font-weight: bold; }

        .result-item { border-bottom: 1px solid #eee; padding: 20px 0; }
        .result-item h3 { margin: 0 0 12px; font-size: 18px; color: #2c3e50; background-color: #e8eaf6; display: inline-block; padding: 6px 12px; border-radius: 6px; }
        .verse-box { display: grid; gap: 8px; }
        .verse-text { margin: 0; line-height: 1.5; padding-left: 10px; border-left: 3px solid transparent; }
        .kr { color: #333; font-weight: 500; border-left-color: #e74c3c; }
        .hr { color: #2e7d32; font-style: italic; border-left-color: #2e7d32; }
        .en { color: #1976d2; border-left-color: #1976d2; }
        .loading { text-align: center; color: #666; font-style: italic; }

        /* í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
        .pagination { display: flex; justify-content: center; gap: 5px; margin-top: 20px; flex-wrap: wrap; }
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: white;
            color: #333;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.3s;
        }
        .page-btn:hover { background-color: #eee; }
        .page-btn.active { background-color: #5c6bc0; color: white; border-color: #5c6bc0; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ 3ê°œ êµ­ì–´ ì„±ê²½ ê²€ìƒ‰</h1>
    
    <div class="search-controls">
        <select id="searchLang">
            <option value="kr">í•œêµ­ì–´ (KR)</option>
            <option value="hr">í¬ë¡œì•„í‹°ì•„ì–´ (HR)</option>
            <option value="en">English (NIV)</option>
        </select>
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì‚¬ë‘, ì°½ì„¸ê¸° 1:1)">
        <button onclick="searchBible()">ê²€ìƒ‰</button>
    </div>

    <div id="resultCount" class="count-display"></div>
    
    <div id="status" class="loading">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div id="results"></div>
    
    <div id="pagination" class="pagination"></div>
</div>

<script>
    let bibleData = [];
    
    // í˜ì´ì§€ë„¤ì´ì…˜ìš© ì „ì—­ ë³€ìˆ˜
    let currentFilteredData = []; 
    let currentPage = 1;          
    const rowsPerPage = 10;       

    // 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì‚¬ìš©ìë‹˜ì´ ì£¼ì‹  URL ì ìš© ì™„ë£Œ!)
    fetch('https://script.google.com/macros/s/AKfycbzBUhwXIy5dswQuzE3vWtPnaCZEOtcP2ryif07-HuG4Qv75YbqWtVL_DWZiN2EdEUkC/exec')
    .then(response => response.json())
    .then(data => {
        bibleData = data;
        document.getElementById('status').innerText = `ë°ì´í„° ë¡œë“œ ì™„ë£Œ! (ì´ ${bibleData.length}êµ¬ì ˆ)`;
        setTimeout(() => { document.getElementById('status').style.display = 'none'; }, 2000);
    })
    .catch(error => {
        console.error(error);
        document.getElementById('status').innerText = "âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
    });

    // 2. ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
    function searchBible() {
        const langMode = document.getElementById('searchLang').value;
        const input = document.getElementById('searchInput').value.toLowerCase().trim();
        
        if (input === "") { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
        if (bibleData.length === 0) { alert("ë°ì´í„° ë¡œë”© ì¤‘ì…ë‹ˆë‹¤."); return; }

        // í•„í„°ë§
        currentFilteredData = bibleData.filter(item => {
            let contentText = "";
            if (langMode === 'kr') contentText = item.content_kr;
            else if (langMode === 'hr') contentText = item.content_hr;
            else if (langMode === 'en') contentText = item.content_en;
            
            // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°(ë¹ˆ ë¬¸ìì—´) ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
            if (!contentText) contentText = "";

            const bookName = item.book ? item.book.toLowerCase() : "";
            const verseRef = `${item.chapter}:${item.verse}`; 

            const basicMatch = contentText.toLowerCase().includes(input) || 
                               bookName.includes(input) || 
                               verseRef === input;

            let complexMatch = false;
            if (input.includes(' ')) {
                const lastSpaceIndex = input.lastIndexOf(' ');
                const searchBook = input.substring(0, lastSpaceIndex).trim();
                const searchRef = input.substring(lastSpaceIndex + 1).trim();

                if (bookName.includes(searchBook)) {
                    if (searchRef.includes(':')) {
                        if (verseRef === searchRef) complexMatch = true;
                    } else {
                        if (verseRef.startsWith(searchRef + ':')) complexMatch = true;
                    }
                }
            }
            return basicMatch || complexMatch;
        });

        // ê²°ê³¼ í™”ë©´ ì„¸íŒ…
        currentPage = 1; 
        updateCountDisplay(); 
        displayList(); 
        setupPagination(); 
    }

    // 3. ì´ ê°œìˆ˜ í‘œì‹œ í•¨ìˆ˜
    function updateCountDisplay() {
        const countDiv = document.getElementById('resultCount');
        if (currentFilteredData.length > 0) {
            countDiv.innerHTML = `ì´ <span class="highlight">${currentFilteredData.length}</span>ê°œì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;
        } else {
            countDiv.innerHTML = "";
        }
    }

    // 4. ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ í•¨ìˆ˜ (10ê°œì”© ìë¥´ê¸°)
    function displayList() {
        const resultContainer = document.getElementById('results');
        resultContainer.innerHTML = "";

        if (currentFilteredData.length === 0) {
            resultContainer.innerHTML = '<div style="text-align:center; color:#888;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const paginatedItems = currentFilteredData.slice(start, end);

        paginatedItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'result-item';
            div.innerHTML = `
                <h3>${item.book} ${item.chapter}:${item.verse}</h3>
                <div class="verse-box">
                    <p class="verse-text kr">ğŸ‡°ğŸ‡· ${item.content_kr}</p>
                    <p class="verse-text hr">ğŸ‡­ğŸ‡· ${item.content_hr}</p>
                    <p class="verse-text en">ğŸ‡ºğŸ‡¸ ${item.content_en}</p>
                </div>
            `;
            resultContainer.appendChild(div);
        });
    }

    // 5. í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
    function setupPagination() {
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = "";

        const pageCount = Math.ceil(currentFilteredData.length / rowsPerPage);
        
        if (pageCount <= 1) return;

        // ë²„íŠ¼ ìƒì„± (ìµœëŒ€ 100í˜ì´ì§€ê°€ ë„˜ì–´ê°€ë©´ UIê°€ ê¹¨ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ 10ê°œì”© ëŠì–´ ë³´ì—¬ì£¼ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ë©´ ë” ì¢‹ìŠµë‹ˆë‹¤. 
        // ì¼ë‹¨ì€ ìš”ì²­í•˜ì‹  ëŒ€ë¡œ ê°„ë‹¨íˆ ì „ì²´ í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.)
        for (let i = 1; i <= pageCount; i++) {
            const btn = document.createElement('button');
            btn.innerText = i;
            btn.className = 'page-btn';
            
            if (i === currentPage) {
                btn.classList.add('active');
            }

            btn.addEventListener('click', function() {
                currentPage = i;
                displayList(); 
                
                // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                let currentBtn = document.querySelector('.pagination button.active');
                if(currentBtn) currentBtn.classList.remove('active');
                btn.classList.add('active');

                // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ ê²°ê³¼ë¡œ ì´ë™ (ì„ íƒì‚¬í•­)
                // document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            });

            paginationContainer.appendChild(btn);
        }
    }

    // ì—”í„°í‚¤ ì´ë²¤íŠ¸
    document.getElementById('searchInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') searchBible();
    });
</script>

</body>
</html>