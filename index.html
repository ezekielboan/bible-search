<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4ê°œ êµ­ì–´ ì„±ê²½ ê²€ìƒ‰</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Roboto:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- [ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ê³¼ ë™ì¼í•©ë‹ˆë‹¤] --- */
        body { 
            font-family: 'Roboto', 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5; 
            display: flex; 
            justify-content: center; 
            padding: 40px 20px;
            margin: 0;
            color: #333;
        }
        .container { 
            width: 100%; 
            max-width: 700px; 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
        }
        h1 { 
            text-align: center; color: #2c3e50; margin: 0 0 25px 0; 
            font-size: 24px; font-weight: 700;
        }
        .search-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        select, input, button { 
            padding: 12px; border-radius: 8px; border: 1px solid #ddd; 
            font-size: 16px; outline: none; -webkit-appearance: none; 
            font-family: 'Roboto', 'Noto Sans KR', sans-serif;
        }
        select { background-color: #fff; min-width: 100px; }
        input { flex: 1; }
        button { 
            background-color: #5c6bc0; color: white; border: none; 
            cursor: pointer; font-weight: bold; min-width: 80px;
        }
        button:active { background-color: #3f51b5; }
        .count-display { margin-bottom: 15px; color: #666; font-size: 14px; text-align: right; }
        .highlight { color: #e74c3c; font-weight: bold; }
        .loading { text-align: center; color: #888; margin: 20px 0; font-size: 14px; }
        .result-item { border-bottom: 1px solid #f1f1f1; padding: 20px 0; }
        .result-item:last-child { border-bottom: none; }
        .result-item h3 { 
            margin: 0 0 10px; font-size: 17px; color: #2c3e50; 
            background-color: #f5f7fa; display: inline-block; 
            padding: 5px 10px; border-radius: 6px; font-weight: 700;
        }
        .verse-box { display: grid; gap: 6px; }
        .verse-text { 
            margin: 0; line-height: 1.6; padding-left: 10px; 
            border-left: 3px solid transparent; font-size: 16px; word-break: keep-all; 
        }
        .kr { color: #333; border-left-color: #e74c3c; font-weight: 500; font-family: 'Noto Sans KR', sans-serif; }
        .ekr { color: #8e24aa; border-left-color: #8e24aa; font-weight: 500; font-family: 'Noto Sans KR', sans-serif; }
        .hr { color: #2e7d32; border-left-color: #2e7d32; font-style: italic; font-size: 15px; font-family: 'Roboto', sans-serif; }
        .en { color: #1976d2; border-left-color: #1976d2; font-size: 15px; font-family: 'Roboto', sans-serif; }
        .pagination { display: flex; justify-content: center; gap: 4px; margin-top: 30px; flex-wrap: wrap; }
        .page-btn {
            padding: 8px 12px; border: 1px solid #eee; background-color: white; 
            color: #555; cursor: pointer; border-radius: 4px; font-size: 14px; 
            font-family: 'Roboto', sans-serif;
        }
        .page-btn.active { background-color: #5c6bc0; color: white; border-color: #5c6bc0; }
        @media (max-width: 600px) {
            body { padding: 10px; background-color: #fff; }
            .container { padding: 15px; box-shadow: none; }
            h1 { font-size: 20px; margin-bottom: 20px; }
            .search-controls { flex-direction: column; gap: 8px; }
            select, input, button { width: 100%; height: 48px; font-size: 16px; }
            .verse-text { font-size: 16px; padding-left: 8px; }
            .result-item { padding: 15px 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“– 4ê°œ êµ­ì–´ ì„±ê²½ ê²€ìƒ‰</h1>
    
    <div class="search-controls">
        <select id="searchLang">
            <option value="kr">ê°œì—­ê°œì • (KR)</option>
            <option value="ekr">ì‰¬ìš´ì„±ê²½ (Easy)</option>
            <option value="hr">í¬ë¡œì•„í‹°ì•„ì–´ (HR)</option>
            <option value="en">English (NIV)</option>
        </select>
        <input type="text" id="searchInput" placeholder="ì˜ˆ: ë§ˆíƒœë³µìŒ 1, ë§ˆíƒœ 1:, ë§ˆíƒœ 1:1-5">
        <button onclick="searchBible()">ê²€ìƒ‰</button>
    </div>

    <div id="resultCount" class="count-display"></div>
    
    <div id="status" class="loading">
        ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...<br>
        (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”)
    </div>
    
    <div id="results"></div>
    <div id="pagination" class="pagination"></div>
</div>

<script>
    let bibleData = [];
    let currentFilteredData = []; 
    let currentPage = 1;          
    const rowsPerPage = 10;       

    // ì‚¬ìš©ìë‹˜ì˜ URL (ê·¸ëŒ€ë¡œ ìœ ì§€)
    const DATA_URL = 'https://script.google.com/macros/s/AKfycbzBUhwXIy5dswQuzE3vWtPnaCZEOtcP2ryif07-HuG4Qv75YbqWtVL_DWZiN2EdEUkC/exec';

    fetch(DATA_URL)
    .then(response => response.json())
    .then(data => {
        bibleData = data;
        const statusDiv = document.getElementById('status');
        statusDiv.innerHTML = "âœ… ì¤€ë¹„ ì™„ë£Œ!";
        setTimeout(() => { statusDiv.style.display = 'none'; }, 1000);
    })
    .catch(error => {
        console.error(error);
        document.getElementById('status').innerText = "âŒ ë°ì´í„° ì—°ê²° ì‹¤íŒ¨";
        document.getElementById('status').style.color = "red";
    });

    function searchBible() {
        const langMode = document.getElementById('searchLang').value;
        const input = document.getElementById('searchInput').value.toLowerCase().trim();
        
        if (input === "") { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
        if (bibleData.length === 0) { alert("ì•„ì§ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤."); return; }

        document.getElementById('searchInput').blur();

        currentFilteredData = bibleData.filter(item => {
            let contentText = "";
            if (langMode === 'kr') contentText = item.content_kr;
            else if (langMode === 'ekr') contentText = item.content_ekr;
            else if (langMode === 'hr') contentText = item.content_hr;
            else if (langMode === 'en') contentText = item.content_en;
            
            if (!contentText) contentText = "";

            const bookName = item.book ? item.book.toLowerCase() : "";
            const verseRef = `${item.chapter}:${item.verse}`; 
            
            const itemChapter = parseInt(item.chapter);
            const itemVerse = parseInt(item.verse);

            const basicMatch = contentText.toLowerCase().includes(input) || 
                               bookName.includes(input) || 
                               verseRef === input;

            let complexMatch = false;
            
            if (input.includes(' ')) {
                const lastSpaceIndex = input.lastIndexOf(' ');
                const searchBook = input.substring(0, lastSpaceIndex).trim();
                const searchRef = input.substring(lastSpaceIndex + 1).trim();

                if (bookName.includes(searchBook)) {
                    
                    // 1. "ë§ˆíƒœë³µìŒ 1:" ì²˜ëŸ¼ ì½œë¡ ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš° (â˜… ì—¬ê¸°ê°€ ì¶”ê°€ëœ ê¸°ëŠ¥!)
                    if (searchRef.endsWith(':')) {
                        // "1:" ì—ì„œ ì½œë¡ ì„ ë–¼ê³  ìˆ«ìë§Œ ê°€ì ¸ì˜´ -> 1
                        const searchChapter = parseInt(searchRef.replace(':', ''));
                        // ê·¸ ì¥ê³¼ ì¼ì¹˜í•˜ë©´ í•©ê²© (ì¥ ì „ì²´ ë³´ì—¬ì£¼ê¸°)
                        if (itemChapter === searchChapter) {
                            complexMatch = true;
                        }
                    }
                    // 2. "1:1-5" ë²”ìœ„ ê²€ìƒ‰
                    else if (searchRef.includes('-') && searchRef.includes(':')) {
                        try {
                            const parts = searchRef.split(':');
                            const searchChapter = parseInt(parts[0]);
                            const rangeParts = parts[1].split('-');
                            const startVerse = parseInt(rangeParts[0]);
                            const endVerse = parseInt(rangeParts[1]);
                            
                            if (itemChapter === searchChapter && 
                                itemVerse >= startVerse && 
                                itemVerse <= endVerse) {
                                complexMatch = true;
                            }
                        } catch (e) {}
                    } 
                    // 3. "1:1" ì •í™•í•œ ì ˆ ê²€ìƒ‰
                    else if (searchRef.includes(':')) {
                        if (verseRef === searchRef) complexMatch = true;
                    } 
                    // 4. "1" ì¥ ì „ì²´ ê²€ìƒ‰
                    else {
                        if (verseRef.startsWith(searchRef + ':')) complexMatch = true;
                    }
                }
            }
            return basicMatch || complexMatch;
        });

        currentPage = 1; 
        updateCountDisplay(); 
        displayList(); 
        setupPagination(); 
    }

    function updateCountDisplay() {
        const countDiv = document.getElementById('resultCount');
        if (currentFilteredData.length > 0) {
            countDiv.innerHTML = `ì´ <span class="highlight">${currentFilteredData.length}</span>êµ¬ì ˆ ë°œê²¬`;
        } else {
            countDiv.innerHTML = "";
        }
    }

    function displayList() {
        const resultContainer = document.getElementById('results');
        resultContainer.innerHTML = "";
        window.scrollTo({ top: 0, behavior: 'smooth' });

        if (currentFilteredData.length === 0) {
            resultContainer.innerHTML = '<div style="text-align:center; color:#888; padding:30px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const paginatedItems = currentFilteredData.slice(start, end);

        paginatedItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'result-item';
            div.innerHTML = `
                <h3>${item.book} ${item.chapter}:${item.verse}</h3>
                <div class="verse-box">
                    <p class="verse-text kr">ğŸ‡°ğŸ‡· ${item.content_kr}</p>
                    <p class="verse-text ekr">ğŸ£ ${item.content_ekr ? item.content_ekr : '(ë°ì´í„° ì—†ìŒ)'}</p>
                    <p class="verse-text hr">ğŸ‡­ğŸ‡· ${item.content_hr}</p>
                    <p class="verse-text en">ğŸ‡ºğŸ‡¸ ${item.content_en}</p>
                </div>
            `;
            resultContainer.appendChild(div);
        });
    }

    function setupPagination() {
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = "";

        const pageCount = Math.ceil(currentFilteredData.length / rowsPerPage);
        if (pageCount <= 1) return;

        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(pageCount, startPage + 4);
        
        if (endPage - startPage < 4) {
            startPage = Math.max(1, endPage - 4);
        }

        for (let i = startPage; i <= endPage; i++) {
            const btn = document.createElement('button');
            btn.innerText = i;
            btn.className = 'page-btn';
            
            if (i === currentPage) btn.classList.add('active');

            btn.addEventListener('click', function() {
                currentPage = i;
                displayList(); 
                setupPagination(); 
            });

            paginationContainer.appendChild(btn);
        }
    }

    document.getElementById('searchInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') searchBible();
    });
</script>

</body>
</html>
